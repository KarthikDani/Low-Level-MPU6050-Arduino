# Low-Level-MPU6050-Arduino
https://github.com/user-attachments/assets/b1870fec-6dee-4ed4-876d-0eb12d9ec74f

## Intro
This project meant as a technical assessment for HyPrix Aviation implements Custom Low Level driver for I2C as well as MPU6050 sensor instead of relying on the standard libraries, bit-banging the I2C protocol, giving us full control over the communication process. This also gives SPEED that's prime requirement in Aviation (as the unneccessary code is avoided).

A set of high-level functions designed specifically to interact with the MPU6050, handling register reads, writes, and data acquisition, the code reads raw 16-bit data from the sensor and then converts it into human-readable engineering units:
- Acceleration in G's
- Angular velocity in degrees per second (dps)
- Temperature in Celsius
  
## Features
- Manually implemented Bit Banged I2C protocol.
- No external libraries are needed to communicate with the sensor.
- Functions to read raw 16-bit accelerometer, gyroscope, and temperature data.
- Converts raw sensor data to standard units (g's, degrees per second, and Celsius).
- Continuously prints formatted sensor data to the serial monitor.

## Technical Breakdown
The project is structured into two main layers, organized by Doxygen-style comments in the code. Statically hosted Documentation can be found at: https://karthikdani.github.io/Low-Level-MPU6050-Arduino/topics.html

### I2C Bit-Banging Layer
I2C protocol is manually generated by manipulating the Arduino's digital I/O pins. The I2C bus is an open-drain architecture, which means the SDA and SCL lines are only actively pulled low. When a line is "released," it is pulled high by an external pull-up resistor. This code emulates this behavior:

- `i2c_sda_low()` / `i2c_scl_low()`: Sets the pin to `OUTPUT` and drives it `LOW`.

- `i2c_sda_high()` / `i2c_scl_high()`: Sets the pin to `INPUT` mode, effectively "releasing" it and allowing the external pull-up resistor to bring the line `HIGH`.

**These functions implement I2C state machine:**

- `i2c_start()`: Generates a START condition by transitioning the SDA line from `HIGH` to `LOW` while SCL is `HIGH`.

- `i2c_stop()`: Generates a STOP condition by transitioning the SDA line from `LOW` to `HIGH` while SCL is `HIGH`.

- `i2c_write_byte(data)`: Iterates through the a byte of data, from MSB to LSB. For each bit, it sets the SDA line and then pulses the SCL line `HIGH` to clock the bit. The 9th clock pulse is used to read the **ACK/NACK** signal from the slave.

- `i2c_read_byte(ack)`: Reads a byte from the slave. After the 8th bit, it sends an ACK (pulling SDA LOW) or NACK (releasing SDA) signal back to the slave to control the flow of data.

### MPU6050 Driver Layer
This layer communicates with the MPU6050's internal registers. It handles the device's I2C address (0x68) and the specific memory map:

- `MPU6050_PWR_MGMT_1_REG` (0x6B): MPU6050 starts in a sleep mode. To wake it up, the code writes a byte with the SLEEP bit (bit 6) cleared. `mpu6050_write_register(0x6B, 0x00)` clears all bits, including the SLEEP bit, thereby waking the device.

- `MPU6050_WHO_AM_I_REG` (0x75): This holds the MPU6050's 7-bit I2C slave address. `mpu6050_read_register(0x75)` reads this register and expects the value 0x68 to confirm the sensor is present and communicating correctly.

- Data Registers (0x3B - 0x48): The code reads a total of 14 bytes of sensor data, but focuses on the following:

  - `ACCEL_XOUT_H_REG` (0x3B): High byte of the X-axis accelerometer data.

  - `GYRO_XOUT_H_REG` (0x43): High byte of the X-axis gyroscope data.

  - `TEMP_OUT_H_REG` (0x41): High byte of the temperature data.

The MPU6050's I2C implementation supports an auto-increment feature. which means the sensor automatically increments the register address for subsequent bytes. The `mpu6050_read_bytes()` takes advantage of this by reading 6 consecutive bytes to get all three accelerometer axis values, and another 6 for the gyroscope data, and 2 for the temperature. The high and low bytes are then combined using bitwise shifting (<< 8) and a bitwise OR (|) to form a single 16-bit signed integer.

## Wiring

| MPU6050 Pin | Arduino Pin |
|-------------|-------------|
| VCC         | 5V          |
| GND         | GND         |
| SDA         | A4          |
| SCL         | A5          |
| AD0         | GND (Default) |


## Expected Output

When the Arduino starts, it will first print:

```
MPU6050 found and initialized successfully.
```

After initialization, the sketch will begin to print a new line of data approximately every 100 milliseconds. The output will look similar to this, with the numerical values changing based on the sensor's movement and temperature:

```
Accel: X=0.04g, Y=0.08g, Z=0.98g | Gyro: X=1.23dps, Y=-0.54dps, Z=0.11dps | Temp: 25.43 C
```


---

My Portfolio: https://karthikdani.vercel.app